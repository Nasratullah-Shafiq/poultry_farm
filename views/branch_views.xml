<!-- poultry_farm_management/views/branch_views.xml -->
<odoo>
    <record id="view_branch_tree" model="ir.ui.view">
        <field name="name">poultry.branch.tree</field>
        <field name="model">poultry.branch</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="code"/>
                <field name="branch_type"/>
                <field name="manager_ids"/>
            </tree>
        </field>
    </record>

    <record id="view_branch_form" model="ir.ui.view">
        <field name="name">poultry.branch.form</field>
        <field name="model">poultry.branch</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="code"/>
                        <field name="branch_type"/>
                        <field name="manager_ids"/>
                        <field name="address"/>
                    </group>
                    <notebook>
                        <page string="Farms">
                            <field name="farm_ids">
                                <tree editable="bottom">
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="location"/>
                                    <field name="capacity"/>
                                    <field name="current_stock"/>
                                    <field name="state"/>
                                    <field name="manager_id"/>
                                </tree>

                                <form>
                                    <group>
                                        <field name="name"/>
                                        <field name="code"/>
                                        <field name="branch_id" readonly="1"/>
                                        <field name="location"/>
                                        <field name="capacity"/>
                                        <field name="current_stock" readonly="1"/>
                                        <field name="manager_id"/>
                                        <field name="state"/>
                                        <field name="note"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>

                </sheet>
                <!-- âœ… Chatter placed inside the form correctly -->
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>


    <!-- ============================== -->
    <!--  KANBAN VIEW FOR BRANCH       -->
    <!-- ============================== -->
    <record id="view_poultry_branch_kanban" model="ir.ui.view">
        <field name="name">poultry.branch.kanban</field>
        <field name="model">poultry.branch</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_example">
                <field name="branch_type"/>
                <field name="farm_names_list"/>
                <templates>
                    <t t-name="kanban-box">

                        <div class="oe_kanban_global_click o_kanban_card card-shadow p-3 mb-3"
                             style="border-radius: 12px; transition: transform 0.2s; cursor: pointer; font-size:16px;">

                            <!-- Header: Branch Name + Code -->
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong class="h4 text-primary">
                                    <field name="name"/>
                                </strong>

                                <span class="badge bg-info text-white" style="font-size:14px;">
                                    <i class="fa fa-tag me-1"></i>
                                    <field name="code"/>
                                </span>
                            </div>

                            <!-- Body Details -->
                            <div class="o_kanban_details mb-2" style="line-height: 1.6;">
                                <!-- Main Branch -->
                                <div>
                                    <i class="fa fa-home text-primary"></i>
                                    Branch:
                                    <span class="badge bg-secondary text-white" style="font-size:14px;">
                                        <t t-esc="record.is_main ? 'Yes' : 'No'"/>
                                    </span>
                                </div>

                                <!-- Managers -->
                                <div>
                                    <i class="fa fa-users text-primary"></i>
                                    Managers:
                                    <field name="manager_ids"/>
                                </div>

                                <!-- Address -->
                                <div>
                                    <i class="fa fa-map-marker text-danger"></i>
                                    Address:
                                    <field name="address"/>
                                </div>

                            </div>

                            <!-- Footer: Display Related Farms -->
                            <div class="mt-3">
                                <i class="fa fa-warehouse"></i>
                                Farms:
                                <t t-if="record.farm_names_list.value">
                                    <t t-foreach="record.farm_names_list.value.split(',')" t-as="farm_name">
                                        <span class="badge bg-info text-white rounded-pill px-3 py-1 me-1 mb-1">
                                            <t t-esc="farm_name"/>
                                        </span>
                                    </t>
                                </t>

                                <t t-else="">
                                    <span class="badge bg-warning text-dark rounded-pill px-3 py-1">
                                        No Farms
                                    </span>
                                </t>
                            </div>

                        </div>

                    </t>
                </templates>

                <kanban quick_create="true"/>
            </kanban>

        </field>
    </record>

    <record id="action_branch" model="ir.actions.act_window">
        <field name="name">Branches</field>
        <field name="res_model">poultry.branch</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="help">Manage branches.</field>
    </record>

    <menuitem id="menu_poultry_branches" name="Branches" parent="menu_poultry_setup" action="action_branch"
              groups="poultry_farm.group_poultry_manager,poultry_farm.group_poultry_record_officer"/>

</odoo>
